# AI Native 研发平台 平台需求文档

## 1. 项目概述

### 1.1 项目简介
AI Native 研发平台 是一个用于管理和发现 AI Agent 相关资源（Skill、MCP、Hook）的统一平台。平台通过对接 GitLab 仓库自动发现和同步资源，为用户提供便捷的查询、查看和安装服务。

### 1.2 项目目标
- 统一管理 Skill、MCP、Hook 三类 AI Agent 资源
- 自动从 GitLab 仓库发现和同步资源
- 提供友好的 Web 界面供用户查询和使用
- 统计资源的使用量和安装量

### 1.3 技术栈
| 层级 | 技术选型 |
|------|----------|
| 后端 | Python + Flask |
| 前端 | Vue.js + Element UI |
| 数据库 | MySQL |
| 任务调度 | APScheduler |

---

## 2. 功能需求

### 2.1 前端功能

#### 2.1.1 资源管理（Skill / MCP / Hook）
- **资源列表**
  - 分页展示所有资源
  - 支持按类型（Skill/MCP/Hook）筛选
  - 支持按名称、描述搜索
  - 显示资源名称、描述、版本、更新时间

- **资源详情**
  - 展示资源完整信息（名称、描述、版本、作者、仓库地址等）
  - 显示使用/安装命令（可复制）
  - 显示使用量和安装量统计
  - 展示 README 文档内容
  - 展示依赖关系

- **资源操作**
  - 复制安装命令到剪贴板
  - 跳转到原始仓库查看
  - 记录安装行为（增加安装计数）

#### 2.1.2 统计面板
- **平台首页**
  - 总资源数量（Skill/MCP/Hook 分别统计）
  - 总安装量
  - 总使用量
  - 同步的仓库数量

- **资源排行**
  - 热门资源排行（按安装量）
  - 最新资源列表
  - 最近更新资源

#### 2.1.3 仓库管理
- 仓库列表
- 添加仓库（输入 GitLab 仓库地址）
- 删除仓库
- 查看仓库同步状态
- 手动触发同步

#### 2.1.4 用户界面要求
- 响应式设计，支持桌面端
- Element UI 组件库统一风格
- 深色/浅色主题切换（可选）

---

### 2.2 后端功能

#### 2.2.1 GitLab 仓库管理
- **仓库接入**
  - 支持添加 GitLab 仓库 URL
  - 验证仓库可访问性
  - 存储仓库配置信息

- **仓库同步**
  - **手动同步**：管理员手动触发单个仓库同步
  - **定时同步**：按配置的时间间隔自动同步所有仓库
  - **增量同步**：只同步有更新的资源
  - **全量同步**：重新扫描所有资源

#### 2.2.2 资源发现与解析
- **Skill 发现**
  - 扫描仓库中的 Skill 定义文件（约定目录结构）
  - 解析 Skill 元数据（名称、描述、版本、参数等）

- **MCP 发现**
  - 扫描仓库中的 MCP Server 定义
  - 解析 MCP 配置和工具列表

- **Hook 发现**
  - 扫描仓库中的 Hook 定义
  - 解析 Hook 触发条件和执行逻辑

#### 2.2.3 资源存储
- 将发现的资源存储到数据库
- 支持资源的 CRUD 操作
- 资源去重（基于仓库 + 路径）
- 记录资源版本历史

#### 2.2.4 统计服务
- 记录资源访问量（页面浏览）
- 记录资源安装量（命令复制/执行）
- 提供统计数据查询接口

#### 2.2.5 API 接口
| 模块 | 接口 | 方法 | 描述 |
|------|------|------|------|
| 资源 | /api/resources | GET | 获取资源列表 |
| 资源 | /api/resources/<id> | GET | 获取资源详情 |
| 资源 | /api/resources/<id>/install | POST | 记录安装行为 |
| 资源 | /api/resources/<id>/view | POST | 记录浏览行为 |
| 仓库 | /api/repositories | GET | 获取仓库列表 |
| 仓库 | /api/repositories | POST | 添加仓库 |
| 仓库 | /api/repositories/<id> | DELETE | 删除仓库 |
| 仓库 | /api/repositories/<id>/sync | POST | 手动触发同步 |
| 仓库 | /api/repositories/<id>/status | GET | 获取同步状态 |
| 统计 | /api/stats/overview | GET | 获取平台首页统计 |
| 统计 | /api/stats/top | GET | 获取热门资源排行 |

---

## 3. 数据库设计

### 3.1 数据表设计

#### 3.1.1 仓库表 (repositories)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | 主键 |
| name | VARCHAR(100) | 仓库名称 |
| url | VARCHAR(500) | GitLab 仓库 URL |
| gitlab_project_id | INT | GitLab 项目 ID |
| sync_enabled | BOOLEAN | 是否启用同步 |
| sync_status | VARCHAR(20) | 同步状态：pending/syncing/success/failed |
| last_sync_at | DATETIME | 最后同步时间 |
| last_sync_status | VARCHAR(20) | 最后同步结果 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 3.1.2 资源表 (resources)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | 主键 |
| repository_id | INT FK | 关联仓库 ID |
| type | VARCHAR(20) | 资源类型：skill/mcp/hook |
| name | VARCHAR(100) | 资源名称 |
| identifier | VARCHAR(200) | 唯一标识（仓库路径） |
| description | TEXT | 描述 |
| version | VARCHAR(50) | 版本号 |
| author | VARCHAR(100) | 作者 |
| readme_content | LONGTEXT | README 内容 |
| install_command | TEXT | 安装命令 |
| path | VARCHAR(500) | 在仓库中的路径 |
| metadata | JSON | 额外元数据 |
| view_count | INT | 浏览量 |
| install_count | INT | 安装量 |
| is_active | BOOLEAN | 是否有效 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 3.1.3 同步日志表 (sync_logs)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | 主键 |
| repository_id | INT FK | 关联仓库 ID |
| status | VARCHAR(20) | 状态：success/failed |
| started_at | DATETIME | 开始时间 |
| finished_at | DATETIME | 结束时间 |
| resources_added | INT | 新增资源数 |
| resources_updated | INT | 更新资源数 |
| resources_removed | INT | 移除资源数 |
| error_message | TEXT | 错误信息 |
| created_at | DATETIME | 创建时间 |

#### 3.1.4 统计记录表 (stats)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | 主键 |
| resource_id | INT FK | 关联资源 ID |
| action_type | VARCHAR(20) | 行为类型：view/install |
| user_ip | VARCHAR(50) | 用户 IP |
| user_agent | VARCHAR(500) | 用户代理 |
| created_at | DATETIME | 创建时间 |

---

## 4. 技术架构

### 4.1 系统架构图
```
┌─────────────────────────────────────────────────────────────┐
│                          前端层                               │
│                     Vue.js + Element UI                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ Skill管理 │  │ MCP管理  │  │ Hook管理 │  │ 统计面板 │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
└─────────────────────────────┬───────────────────────────────┘
                              │ REST API
┌─────────────────────────────┴───────────────────────────────┐
│                          后端层                               │
│                        Flask 应用                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ 资源服务  │  │ 仓库服务  │  │ 统计服务  │  │ 同步服务  │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
└─────────────────────────────┬───────────────────────────────┘
                              │
┌─────────────────────────────┴───────────────────────────────┐
│                          数据层                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                   │
│  │ MySQL/PG │  │ GitLab API│  │APScheduler│                  │
│  └──────────┘  └──────────┘  └──────────┘                   │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 项目目录结构
```
ai-agent-hub/
├── backend/
│   ├── app/
│   │   ├── __init__.py          # Flask 应用初始化
│   │   ├── config.py            # 配置文件
│   │   ├── models/              # 数据库模型
│   │   │   ├── __init__.py
│   │   │   ├── repository.py
│   │   │   ├── resource.py
│   │   │   └── sync_log.py
│   │   ├── schemas/             # API 数据模式
│   │   │   ├── __init__.py
│   │   │   ├── resource.py
│   │   │   └── repository.py
│   │   ├── services/            # 业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── resource_service.py
│   │   │   ├── repository_service.py
│   │   │   ├── sync_service.py
│   │   │   └── stats_service.py
│   │   ├── api/                 # API 路由
│   │   │   ├── __init__.py
│   │   │   ├── resources.py
│   │   │   ├── repositories.py
│   │   │   └── stats.py
│   │   ├── sync/                # 同步器
│   │   │   ├── __init__.py
│   │   │   ├── base.py
│   │   │   ├── skill_syncer.py
│   │   │   ├── mcp_syncer.py
│   │   │   └── hook_syncer.py
│   │   └── utils/               # 工具函数
│   │       ├── __init__.py
│   │       └── gitlab_client.py
│   ├── migrations/              # 数据库迁移
│   ├── tests/                   # 测试
│   ├── requirements.txt
│   └── run.py                   # 启动文件
├── frontend/
│   ├── src/
│   │   ├── api/                 # API 调用
│   │   ├── components/          # 组件
│   │   ├── views/               # 页面
│   │   │   ├── SkillList.vue
│   │   │   ├── MCPList.vue
│   │   │   ├── HookList.vue
│   │   │   ├── ResourceDetail.vue
│   │   │   ├── RepositoryManage.vue
│   │   │   └── Dashboard.vue
│   │   ├── router/              # 路由
│   │   ├── store/               # 状态管理
│   │   ├── App.vue
│   │   └── main.js
│   ├── package.json
│   └── vite.config.js
├── docs/
│   └── 需求.md
└── README.md
```

---

## 5. 同步机制设计

### 5.1 资源目录约定
```
gitlab-repo/
├── skills/              # Skill 定义目录
│   ├── skill-1/
│   │   ├── skill.yaml   # Skill 元数据
│   │   ├── README.md
│   │   └── ...
│   └── skill-2/
├── mcp/                 # MCP Server 定义目录
│   ├── mcp-1/
│   │   ├── mcp.yaml     # MCP 元数据
│   │   ├── README.md
│   │   └── ...
│   └── mcp-2/
└── hooks/               # Hook 定义目录
    ├── hook-1/
    │   ├── hook.yaml    # Hook 元数据
    │   ├── README.md
    │   └── ...
    └── hook-2/
```

### 5.2 元数据文件格式 (YAML)
```yaml
# skill.yaml / mcp.yaml / hook.yaml
name: "示例资源名称"
identifier: "example-resource"
version: "1.0.0"
description: "资源描述信息"
author: "作者名"
tags:
  - "tag1"
  - "tag2"
```

### 5.3 同步流程
```
1. 定时任务触发 / 手动触发
2. 获取所有启用的仓库
3. 对每个仓库：
   a. 调用 GitLab API 获取文件列表
   b. 扫描 skills/、mcp/、hooks/ 目录
   c. 解析每个资源的元数据文件
   d. 对比数据库，判断是新增/更新/删除
   e. 更新数据库记录
   f. 记录同步日志
```

### 5.4 定时同步配置
- 同步间隔：可配置（默认 1 小时）
- 同步时间：可配置定时执行时间
- 失败重试：支持自动重试机制

---

## 6. 非功能需求

### 6.1 性能要求
- 资源列表响应时间 < 500ms
- 资源详情响应时间 < 300ms
- 支持并发用户数 > 100

### 6.2 安全要求
- GitLab Token 加密存储
- API 接口防刷限制
- 输入数据校验和过滤

### 6.3 可用性要求
- 系统可用性 > 99%
- 同步失败自动记录和告警
- 支持优雅停机

---

## 7. 实施计划

### 7.1 开发阶段
| 阶段 | 内容 |
|------|------|
| 第一阶段 | 数据库设计与创建、后端基础框架搭建 |
| 第二阶段 | GitLab 同步服务开发（Skill/MCP/Hook） |
| 第三阶段 | 后端 API 开发 |
| 第四阶段 | 前端页面开发（资源管理、仓库管理） |
| 第五阶段 | 统计功能开发、定时任务配置 |
| 第六阶段 | 测试与优化 |

### 7.2 验收标准
- 能够成功添加 GitLab 仓库
- 能够自动发现和同步 Skill/MCP/Hook
- 前端能正确展示资源列表和详情
- 安装命令能正确显示和复制
- 统计数据准确记录

---

## 8. 附录

### 8.1 GitLab API 参考
- 获取项目文件：`GET /projects/:id/repository/tree`
- 获取文件内容：`GET /projects/:id/repository/files/:file_path/raw`

```
